<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSS Grid Maze</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column; /* Stack controls below the maze */
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #121212;
            margin: 0;
            overflow: hidden;
        }

        #maze-container {
            display: grid;
            grid-template-columns: repeat(10, 30px);
            grid-template-rows: repeat(10, 30px);
            border: 4px solid #4CAF50;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
            background-color: #222;
        }

        .cell {
            width: 30px;
            height: 30px;
            box-sizing: border-box;
            background-color: #222;
        }

        .wall-top { border-top: 2px solid #4CAF50; }
        .wall-right { border-right: 2px solid #4CAF50; }
        .wall-bottom { border-bottom: 2px solid #4CAF50; }
        .wall-left { border-left: 2px solid #4CAF50; }

        .player {
            background-color: #f44336;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(244, 67, 54, 0.7);
            transition: transform 0.1s ease-out;
            /* z-index: 2; */ /* Ensure player is on top */
        }

        .visited { background-color: #2a2a2a; }
        .end {
            background-color: #FFD700;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
        }

        #controls {
            margin-top: 20px;
            text-align: center;
            color: white;
        }
        #controls button { margin: 5px; }

        #message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 2em;
            font-weight: bold;
            text-shadow: 2px 2px 4px #000000;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            display: none;
            z-index: 10;
        }
    </style>
</head>
<body>

    <div id="maze-container"></div>
    <div id="message"></div>
    <div id="controls">
        <button id="start-button">Start Game</button>
        <button id="reset-button">Reset Maze</button>
    </div>

    <script>
        const mazeContainer = document.getElementById('maze-container');
        const startButton = document.getElementById('start-button');
        const resetButton = document.getElementById('reset-button');
        const messageDiv = document.getElementById('message');
        let playerRow, playerCol;
        let maze;
        let endRow, endCol;
        let gameStarted = false; // Flag to control game state

        function generateMaze(rows, cols) {
           const grid = Array(rows).fill(null).map(() => Array(cols).fill(null).map(() => ({
                top: true, right: true, bottom: true, left: true, visited: false
            })));

            function carvePath(row, col) {
                grid[row][col].visited = true;
                const directions = [
                    { dr: -1, dc: 0, wall: 'top', opposite: 'bottom' },
                    { dr: 0, dc: 1, wall: 'right', opposite: 'left' },
                    { dr: 1, dc: 0, wall: 'bottom', opposite: 'top' },
                    { dr: 0, dc: -1, wall: 'left', opposite: 'right' }
                ];
                directions.sort(() => Math.random() - 0.5);

                for (const dir of directions) {
                    const newRow = row + dir.dr;
                    const newCol = col + dir.dc;
                    if (newRow >= 0 && newRow < rows && newCol >= 0 && newCol < cols && !grid[newRow][newCol].visited) {
                        grid[row][col][dir.wall] = false;
                        grid[newRow][newCol][dir.opposite] = false;
                        carvePath(newRow, newCol);
                    }
                }
            }
            carvePath(0, 0);
            return grid;
        }

        function renderMaze(maze) {
            mazeContainer.innerHTML = '';
            for (let row = 0; row < maze.length; row++) {
                for (let col = 0; col < maze[row].length; col++) {
                    const cell = maze[row][col];
                    const cellDiv = document.createElement('div');
                    cellDiv.classList.add('cell');
                    cellDiv.dataset.row = row;
                    cellDiv.dataset.col = col;
                    if (cell.top) cellDiv.classList.add('wall-top');
                    if (cell.right) cellDiv.classList.add('wall-right');
                    if (cell.bottom) cellDiv.classList.add('wall-bottom');
                    if (cell.left) cellDiv.classList.add('wall-left');
                    mazeContainer.appendChild(cellDiv);
                }
            }
            createPlayer(); // Create player after maze is rendered
            createEnd();
        }

        function createPlayer() {
            const playerDiv = document.createElement('div');
            playerDiv.classList.add('player');
            mazeContainer.appendChild(playerDiv);
            playerRow = 0;
            playerCol = 0;
            updatePlayerPosition();
        }
        function createEnd() {
            endRow = maze.length - 1;
            endCol = maze[0].length - 1;
            const endCell = document.querySelector(`.cell[data-row="${endRow}"][data-col="${endCol}"]`);
            endCell.classList.add("end");
        }


        function updatePlayerPosition() {
            const playerDiv = document.querySelector('.player');
            const cellWidth = 30;
            const cellHeight = 30;
            playerDiv.style.transform = `translate(${playerCol * cellWidth}px, ${playerRow * cellHeight}px)`;
             document.querySelector(`.cell[data-row="${playerRow}"][data-col="${playerCol}"]`).classList.add("visited");

        }


       function handleKeyPress(event) {
            if (!gameStarted) return; // Ignore input if game hasn't started

            let newRow = playerRow;
            let newCol = playerCol;
            let moved = false;

            switch (event.key) {
                case 'ArrowUp':
                    if (!maze[playerRow][playerCol].top) { newRow--; moved = true; } break;
                case 'ArrowDown':
                    if (!maze[playerRow][playerCol].bottom) { newRow++; moved = true; } break;
                case 'ArrowLeft':
                    if (!maze[playerRow][playerCol].left) { newCol--; moved = true; } break;
                case 'ArrowRight':
                    if (!maze[playerRow][playerCol].right) { newCol++; moved = true; } break;
            }

            if (moved) {
                playerRow = newRow;
                playerCol = newCol;
                updatePlayerPosition();
                if (playerRow === endRow && playerCol === endCol) {
                    endGame(true); // Win condition
                }
            }
        }

        function showWinMessage() {
            messageDiv.textContent = "Congratulations! You solved the maze!";
            messageDiv.style.display = "block";
        }

         function startGame() {
            if (!gameStarted) { // Prevent starting multiple games
                gameStarted = true;
                maze = generateMaze(10, 10);
                renderMaze(maze);
                messageDiv.style.display = 'none';
                document.addEventListener('keydown', handleKeyPress); // Attach listener here
            }
        }

        function endGame(won) {
            gameStarted = false;
            document.removeEventListener('keydown', handleKeyPress); // Remove key listener

            if (won) {
                showWinMessage();
            } else {
                 messageDiv.textContent = "Game Reset!";
                 messageDiv.style.display = "block";
            }
        }


        function resetGame(){
             endGame(false); // End the current game without a win
            //startGame(); // Don't auto-start, let the user click "Start" again
        }


        startButton.addEventListener('click', startGame);
        resetButton.addEventListener('click', resetGame);

    </script>
</body>
</html>
